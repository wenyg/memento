---
globs: *.ts
description: Markdown 文件处理和解析规范
---

# Markdown 处理规范

## Front Matter 解析
- 支持 YAML 格式的 Front Matter
- 解析 `title`、`date`、`tags` 等字段
- 处理数组格式的 tags（`[tag1, tag2]` 和 `- tag1\n- tag2`）
- 移除引号包装的字符串值
- 验证日期格式的有效性

## 标签提取
- 支持两种标签格式：
  1. Front Matter 中的 `tags` 字段
  2. 正文中的 `#标签` 格式
- 支持层级标签（如 `#工作/项目`）
- 支持中文标签和特殊字符
- 排除代码块中的标签

## 标题提取
- 优先使用 Front Matter 中的 `title` 字段
- 回退到第一个 `# 标题` 格式
- 最后使用文件名（不含扩展名）
- 移除代码块避免误匹配

## 文件扫描
- 递归扫描目录结构
- 支持排除文件夹配置
- 支持通配符模式（如 `temp*`）
- 自动跳过隐藏文件夹（以 `.` 开头）

## 日期处理
- 优先使用 Front Matter 中的 `date` 字段
- 回退到文件创建时间
- 支持 ISO 格式日期
- 验证日期有效性

## 代码块处理
- 移除 fenced code blocks（```...```）
- 移除 inline code（`...`）
- 避免在代码中匹配标签和标题

## 模板系统
- 支持变量替换（`{{year}}`、`{{month}}` 等）
- 支持自定义模板路径
- 提供默认模板
- 处理模板文件不存在的情况

## 文件操作
- 异步文件读写操作
- 错误处理和回退机制
- 支持 UTF-8 编码
- 处理文件权限问题

## 正则表达式
- 使用 Unicode 字符类支持中文
- 避免贪婪匹配
- 正确处理转义字符
- 测试边界情况

## 性能优化
- 缓存解析结果
- 避免重复文件扫描
- 使用流式处理大文件
- 异步处理避免阻塞 UI